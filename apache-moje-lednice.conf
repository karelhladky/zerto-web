# =============================================================
# Moje lednice — Apache VirtualHost pro moje-lednice.cz
# =============================================================
#
# Prerekvizity — povolit potřebné moduly:
#   sudo a2enmod proxy proxy_http rewrite
#   sudo systemctl restart apache2
#
# 1. Ulož tento soubor jako:
#    /etc/apache2/sites-available/moje-lednice.conf
#
# 2. Aktivuj:
#    sudo a2ensite moje-lednice.conf
#    sudo systemctl reload apache2
#
# 3. Vygeneruj SSL certifikát:
#    sudo certbot --apache -d moje-lednice.cz -d www.moje-lednice.cz
#
# =============================================================

# --- HTTP → HTTPS přesměrování ---

<VirtualHost *:80>
    ServerName moje-lednice.cz
    ServerAlias www.moje-lednice.cz

    RewriteEngine on
    RewriteCond %{SERVER_NAME} =www.moje-lednice.cz [OR]
    RewriteCond %{SERVER_NAME} =moje-lednice.cz
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

# --- HTTPS VirtualHost (Certbot doplní SSL direktivy) ---
# Po spuštění certbot se vytvoří *-le-ssl.conf automaticky.
# Pokud chceš ručně, použij tento blok a doplň cesty k certifikátům:

<VirtualHost *:443>
    ServerName moje-lednice.cz
    ServerAlias www.moje-lednice.cz

    # Reverse proxy na Express server
    ProxyPreserveHost On
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/

    ErrorLog ${APACHE_LOG_DIR}/moje-lednice-error.log
    CustomLog ${APACHE_LOG_DIR}/moje-lednice-access.log combined

    # SSL — Certbot doplní automaticky, nebo vyplň ručně:
    # SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/moje-lednice.cz/fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/moje-lednice.cz/privkey.pem
    # Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>

# =============================================================
# Nasazení krok za krokem:
#
# 1. Na serveru buildni frontend:
#      cd /cesta/k/moje-lednice/client && npm run build
#
# 2. Spusť Express server (doporučuji přes pm2):
#      cd /cesta/k/moje-lednice/server
#      pm2 start "node --import tsx src/index.ts" --name moje-lednice
#
# 3. Ulož tento soubor a aktivuj VirtualHost:
#      sudo cp apache-moje-lednice.conf /etc/apache2/sites-available/moje-lednice.conf
#      sudo a2ensite moje-lednice.conf
#      sudo systemctl reload apache2
#
# 4. Vygeneruj SSL:
#      sudo certbot --apache -d moje-lednice.cz -d www.moje-lednice.cz
#
# 5. Aplikace bude dostupná na:
#      https://moje-lednice.cz
# =============================================================
